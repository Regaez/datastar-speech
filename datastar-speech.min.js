import{action as p}from"datastar";const E="datastar-speech-status",y="datastar-speech-voices-loaded",o="prefer-lang",r="replace",u="immediate",d="next",g="append;",T=500,v=33,w=8,n=window.speechSynthesis,f=(i,e,t)=>Math.max(e,Math.min(t,i)),U=(i,e)=>{let t=0;return(...s)=>{t&&clearTimeout(t),t=setTimeout(()=>{i(...s),t=0},e)}};function b(i){switch(i){case r:case u:case d:return i;default:return g}}const c=new Promise(i=>{let e=n.getVoices();const t=s=>setTimeout(()=>{window.dispatchEvent(new CustomEvent(y,{detail:s})),i(s)},0);e.length===0?n.onvoiceschanged=()=>{t(n.getVoices())}:t(e)});class P{#e=[];#t=0;#n=!1;#s=!1;#l=!1;#a;#f;#c;#p=1;#d=1;#g=1;#o=null;#i=U(this.#T.bind(this),w);constructor(){n.cancel(),this.#i()}#r(){return this.#t<this.#e.length-1}#m(){return this.#t>0}#E(){this.#s=!0,this.#n=!1,this.#l=!1,this.#i()}#u(e=!0){this.#c=e,this.#l=!0,this.#s=!1,clearTimeout(this.#f),this.#i()}#y(){this.#s=!1,!this.#l&&!this.#n&&this.#r()&&(this.#a=setTimeout(()=>{this.#a=void 0,this.next()},T)),this.#i()}#T(){window.dispatchEvent(new CustomEvent(E,{detail:{isPlaying:this.#s,canPlay:this.#e.length>0&&!this.#s,canPause:this.#s,canReset:this.#e.length>0,hasNext:this.#r(),hasPrevious:this.#m(),queue:this.#e.map(e=>e.text),index:this.#t}}))}add(e,{queue:t,...s}){let a={text:e,opts:s};switch(t){case r:this.#e=[a],this.#t=0;break;case u:this.#e=[...this.#e.slice(0,this.#t),a,...this.#e.slice(this.#t)];break;case d:this.#t<this.#e.length-1?this.#e=[...this.#e.slice(0,this.#t+1),a,...this.#e.slice(this.#t+1)]:this.#e.push(a);break;case g:this.#e.push(a);break}[u,r].includes(t)?this.#h(!0):!this.#n&&!this.#s&&(this.#e.length<2?this.#h():this.next()),this.#i()}#h(e=!1){if(!this.#e.length)return;let{text:t,opts:{lang:s,voice:a}}=this.#e[this.#t],h=new SpeechSynthesisUtterance(t);h.pitch=this.#p,h.rate=this.#d,h.volume=this.#g,h.voice=a===o?s?null:this.#o:a||this.#o,h.lang=s||document.documentElement.lang||navigator.language||null,h.onstart=this.#E.bind(this),h.onresume=this.#E.bind(this),h.onpause=()=>this.#u(),h.onend=this.#y.bind(this),h.onerror=this.#y.bind(this),this.#n=!0;const l=()=>n.speak(h);e?(this.#a&&clearTimeout(this.#a),n.cancel(),c.then(l)):!this.#s&&this.#e.length&&(n.paused&&n.speaking?n.resume():c.then(l))}#v(){this.#s=!1,n.cancel(),this.#i()}configure({pitch:e,rate:t,volume:s,voice:a}={}){typeof e=="number"&&(this.#p=f(e,0,2)),typeof t=="number"&&(this.#d=f(t,.1,10)),typeof s=="number"&&(this.#g=f(s,0,1)),typeof a=="string"?c.then(h=>{this.#o=h.find(l=>l.name===a)??null,this.#s&&this.#h(!0)}):this.#s&&this.#h(!0)}next(){this.#r()&&(this.#t++,this.#h(!0))}pause(){this.#s&&(typeof this.#c>"u"&&(this.#f=setTimeout(()=>{this.#u(!1),n.cancel()},v)),this.#c===!1?(this.#u(!1),n.cancel()):n.pause(),this.#i())}play({index:e}={}){if(typeof e!="number"||e>=this.#e.length){this.#h();return}this.#t=e,this.#h(!0)}previous(){this.#m()&&(this.#t--,this.#h(!0))}remove({index:e}={}){typeof e!="number"||e>=this.#e.length||(this.#e.splice(e,1),e<this.#t?this.#t--:this.#t===e&&(e>0&&e>=this.#e.length&&this.#t--,e<this.#e.length?this.#h(!0):this.#v()),this.#i())}reset(){this.#s=!1,this.#t=0,this.#e=[],n.cancel(),this.#i()}}p({name:"speech",apply:({error:i},e,t={})=>{if(typeof n>"u")throw i("SpeechSynthesisUnsupported");let s="";if(typeof e=="string")s=e;else if(typeof e=="boolean")s=String(e);else if(typeof e=="number")s=e.toLocaleString(navigator.languages);else if(e instanceof HTMLElement)s=e.innerText.replaceAll(`
`,". ");else throw i("InvalidInputType");if(s=s.trim(),s.length>32767)throw i("MaxInputLengthExceeded");if(typeof t.lang<"u"&&typeof t.lang!="string")throw i("InvalidLangType");c.then(a=>{let h=t.voice===o?o:a.find(l=>l.name===t.voice);m.add(s,{queue:b(t?.queue),lang:t.lang,voice:h})})}}),p({name:"speechCtrl",apply:({error:i},e,t={})=>{if(typeof t!="object")throw i("InvalidOptionsType");switch(e){case"configure":case"next":case"pause":case"play":case"previous":case"remove":case"reset":m[e](t);return;default:throw i("InvalidAction")}}});const m=new P;
